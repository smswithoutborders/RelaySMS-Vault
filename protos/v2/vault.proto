syntax = "proto3";

package vault.v2;

// Request message for creating an entity.
message CreateEntityRequest {
  // The ISO 3166-1 alpha-2 country code of the entity.
  string country_code = 1;
  // The phone number of the entity (optional).
  string phone_number = 2;
  // The email address of the entity (optional).
  string email_address = 3;
  // The password of the entity.
  string password = 4;
  // The ownership proof response from the client.
  string ownership_proof_response = 5;
  // The captcha token
  string captcha_token = 6;
  // The client's identification public key.
  bytes client_id_pub_key = 7;
  // The client's ratchet public key.
  bytes client_ratchet_pub_key = 8;
  // The client's header public key.
  bytes client_header_pub_key = 9;
  // The client's next header public key.
  bytes client_next_header_pub_key = 10;
  // The client's nonce.
  bytes client_nonce = 11;
}

// Response message for creating an entity.
message CreateEntityResponse {
  // Indicates if ownership proof is required.
  bool requires_ownership_proof = 1;
  // A long-lived token for the authenticated entity.
  string long_lived_token = 2;
  // The server's ratchet public key.
  bytes server_ratchet_pub_key = 3;
  // The server's header public key.
  bytes server_header_pub_key = 4;
  // The server's next header public key.
  bytes server_next_header_pub_key = 5;
  // The server's nonce.
  bytes server_nonce = 6;
  // A response message.
  string message = 7;
  // The next available time to request another proof of ownership.
  int32 next_attempt_timestamp = 8;
}

// Request message for authenticating an entity.
message AuthenticateEntityRequest {
  // The phone number of the entity (optional).
  string phone_number = 1;
  // The email address of the entity (optional).
  string email_address = 2;
  // The password of the entity.
  string password = 3;
  // The ownership proof response from the client.
  string ownership_proof_response = 4;
  // The captcha token
  string captcha_token = 5;
  // The client's identification public key.
  bytes client_id_pub_key = 6;
  // The client's ratchet public key.
  bytes client_ratchet_pub_key = 7;
  // The client's header public key.
  bytes client_header_pub_key = 8;
  // The client's next header public key.
  bytes client_next_header_pub_key = 9;
  // The client's nonce.
  bytes client_nonce = 10;
}

// Response message for authenticating an entity.
message AuthenticateEntityResponse {
  // Indicates if ownership proof is required.
  bool requires_ownership_proof = 1;
  // A long-lived token for the authenticated entity.
  string long_lived_token = 2;
  // The server's ratchet public key.
  bytes server_ratchet_pub_key = 3;
  // The server's header public key.
  bytes server_header_pub_key = 4;
  // The server's next header public key.
  bytes server_next_header_pub_key = 5;
  // The server's nonce.
  bytes server_nonce = 6;
  // A response message.
  string message = 7;
  // The next available time to request another proof of ownership.
  int32 next_attempt_timestamp = 8;
  // indicates if user must reset their password
  bool requires_password_reset = 9;
}

// Request message for listing entity's stored tokens.
message ListEntityStoredTokensRequest {
  // Indicates if the token should be removed from the cloud and sent to the device.
  bool migrate_to_device = 1;
}

// Response message for listing entity's stored tokens.
message ListEntityStoredTokensResponse {
  // The list of stored tokens.
  repeated Token stored_tokens = 1;
  // A response message.
  string message = 2;
}

// Represents a token.
message Token {
  // The platform associated with the token.
  string platform = 1;
  // The unique identifier of the account associated with the token.
  string account_identifier = 2;
  // Access and refresh tokens
  map<string, string> account_tokens = 3;
  // Indicates if the token is already stored on the device.
  bool is_stored_on_device = 4;
}

// Request message for resetting an entity's password.
message ResetPasswordRequest {
  // The phone number of the entity (optional).
  string phone_number = 1;
  // The email address of the entity (optional).
  string email_address = 2;
  // The new password of the entity.
  string new_password = 3;
  // The ownership proof response from the client.
  string ownership_proof_response = 4;
  // The captcha token
  string captcha_token = 5;
  // The client's identification public key.
  bytes client_id_pub_key = 6;
  // The client's ratchet public key.
  bytes client_ratchet_pub_key = 7;
  // The client's header public key.
  bytes client_header_pub_key = 8;
  // The client's next header public key.
  bytes client_next_header_pub_key = 9;
  // The client's nonce.
  bytes client_nonce = 10;
}

// Response message for resetting an entity's password.
message ResetPasswordResponse {
  // Indicates if ownership proof is required.
  bool requires_ownership_proof = 1;
  // A long-lived token for the authenticated entity.
  string long_lived_token = 2;
  // The server's ratchet public key.
  bytes server_ratchet_pub_key = 3;
  // The server's header public key.
  bytes server_header_pub_key = 4;
  // The server's next header public key.
  bytes server_next_header_pub_key = 5;
  // The server's nonce.
  bytes server_nonce = 6;
  // A response message.
  string message = 7;
  // The next available time to request another proof of ownership.
  int32 next_attempt_timestamp = 8;
}

// Request message for decrypting payload.
message DecryptPayloadRequest {
  // Device ID for identifying the requesting device.
  string device_id = 1;
  // Encrypted payload that needs to be decrypted.
  string payload_ciphertext = 2;
  // The phone number of the entity.
  string phone_number = 3;
}

message DecryptPayloadResponse {
  // Decrypted plaintext payload.
  string payload_plaintext = 1;
  // A response message.
  string message = 2;
  // Indicates whether the operation was successful.
  bool success = 3;
  // The ISO 3166-1 alpha-2 country code of the entity.
  string country_code = 4;
}

// Service for managing entities.
service Entity {
  // Creates an entity.
  rpc CreateEntity(CreateEntityRequest) returns (CreateEntityResponse);
  // Authenticates an entity.
  rpc AuthenticateEntity(AuthenticateEntityRequest) returns (AuthenticateEntityResponse);
  // Lists all stored access tokens for an entity.
  rpc ListEntityStoredTokens(ListEntityStoredTokensRequest) returns (ListEntityStoredTokensResponse);
  // Resets an entity's password
  rpc ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse);
}

// Service for managing entities internally.
service EntityInternal {
  // Decrypt payload.
  rpc DecryptPayload(DecryptPayloadRequest) returns (DecryptPayloadResponse);
}
